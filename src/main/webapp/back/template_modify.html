<!DOCTYPE html>
<!--
  ~ 版权所有:杭州火图科技有限公司
  ~ 地址:浙江省杭州市滨江区西兴街道阡陌路智慧E谷B幢4楼
  ~
  ~ (c) Copyright Hangzhou Hot Technology Co., Ltd.
  ~ Floor 4,Block B,Wisdom E Valley,Qianmo Road,Binjiang District
  ~ 2013-2016. All rights reserved.
  -->

<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>


    <title>表单详情</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>

    <link rel="shortcut icon" href="favicon.ico"/>
    <link href="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/plugins/iCheck/custom.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/animate.min.css" rel="stylesheet"/>
    <link href="../css/style.min.css?v=4.0.0" rel="stylesheet"/><base target="_blank"/>

    <style>
        .droppable-active {
            background-color: #ffe!important
        }

        .tools a {
            cursor: pointer;
            font-size: 80%
        }

        .form-body .col-md-6,.form-body .col-md-12 {
            min-height: 400px
        }

        .draggable {
            cursor: move
        }
    </style>

</head>

<body onload="templateEdit.load()" class="gray-bg">
<div class="wrapper wrapper-content">
    <div class="col-sm-4">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>元素</h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>

                </div>
            </div>
            <div class="ibox-content">

                <div class="alert alert-info">
                    拖拽左侧的表单元素到右侧区域，即可生成相应的HTML代码，表单代码，轻松搞定！
                </div>
                <form role="form" class="form-horizontal m-t">

                    <div class="form-group">
                        <label class="col-sm-3 control-label">模板名称：</label>
                        <div class="col-sm-9">
                            <input th:value="${template.name}" type="text" name="templateName" class="form-control" placeholder="请输入文本"/>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>
                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>文本框：</span></label>
                        <div class="col-sm-10">
                            <input type="text" name="" class="form-control"/>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>


                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>富文本：</span></label>
                        <div class="col-sm-10">
                            <div class="summernote">
                            </div>

                        </div>
                    </div>


                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>表格：</span></label>
                        <div class="col-sm-10">
                            <table class="table table-bordered">
                            <thead class=" sortable">
                            <tr>
                            <th>#</th>
                            <th>姓名</th>
                            <th>性别</th>
                            <th>年龄</th>
                            <th class="draggable">年龄</th>
                            </tr>
                            </thead>
                            <tbody class=" sortable">
                            <tr class="draggable">
                            <td>1</td>
                            <td>张三</td>
                            <td>男</td>
                            <td>23</td>
                            <td class="draggable">23</td>
                            </tr>
                            <tr class="draggable">
                            <td>2</td>
                            <td>李四</td>
                            <td>男</td>
                            <td>27</td>
                            <td>23</td>
                            </tr>

                            </tbody>
                            </table>
                        </div>
                    </div>

                    <!--<div class="form-group">-->
                        <!--<label class="col-sm-2 control-label"><span>列：</span></label>-->
                        <!--<div class="col-sm-10">-->
                            <!--<table>-->
                                <!--<tr class="draggable">-->
                                    <!--<th class="draggable">123456</th>-->
                                <!--</tr>-->
                            <!--</table>-->
                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="form-group">-->
                        <!--<label class="col-sm-2 control-label"><span>行：</span></label>-->
                        <!--<div class="col-sm-10">-->
                            <!--<table>-->
                                <!--<tr class="draggable">-->
                                    <!--<td>123456</td>-->
                                    <!--<td>123456</td>-->
                                    <!--<td>123456</td>-->
                                    <!--<td>123456</td>-->
                                    <!--<td>123456</td>-->
                                <!--</tr>-->
                            <!--</table>-->
                        <!--</div>-->
                    <!--</div>-->

                    <div class="hr-line-dashed"></div>
                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>纯文本：</span></label>
                        <div class="col-sm-10">
                            <p class="form-control-static"><span>这里是纯文字信息</span></p>
                        </div>
                    </div>

                    <!--<div class="hr-line-dashed"></div>-->
                    <!--<div class="form-group draggable">-->
                        <!--<label class="col-sm-2 control-label"><span>单选框：</span></label>-->
                        <!--<div class="col-sm-10 sortable">-->
                            <!--<label class="radio-inline">-->
                                <!--<input name="sex" type="radio" value="option1"/><span>选项1</span>-->
                            <!--</label>-->
                            <!--<label class="radio-inline draggable">-->
                                <!--<input name="sex" type="radio" value="option2"/><span>选项2</span></label>-->
                        <!--</div>-->
                    <!--</div>-->
                    <div class="hr-line-dashed"></div>

                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>复选框：</span></label>
                        <div class="col-sm-10 sortable">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="option1" id="inlineCheckbox1"/>&nbsp;<span>选项1</span></label>
                            <label class="checkbox-inline">
                                <input type="checkbox" value="option2" id="inlineCheckbox2"/>&nbsp;<span>选项2</span></label>
                            <label class="checkbox-inline draggable">
                                <input type="checkbox" value="option3" id="inlineCheckbox3"/>&nbsp;<span>选项3</span></label>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>
                    <div class=" text-center">
                        <button class="btn btn-primary" type="button" onclick="templateEdit.newArea()">新建区域</button>
                        <button class="btn btn-primary" type="button" onclick="templateEdit.save()">保存模板</button>
                    </div>
                </form>
                <div class="clearfix"></div>
            </div>
        </div>


    </div>
    <div class="col-sm-8" th:utext="${template.content}"></div>

</div>

<script src="http://resali.huobanplus.com/cdn/jquery/2.2.4/jquery.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/bootstrap.min.js"></script>
<script src="../js/content.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/jquery-ui-1.10.4.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/beautifyhtml/beautifyhtml.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/iCheck/icheck.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/layer/2.4/layer.js"></script>

<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
//    $(document).ready(function(){$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",})});
    var templateEdit={};

    templateEdit.load=function(){
        templateEdit.bindTitle();
        templateEdit.bindTitleSave();
        templateEdit.bindTable();
        templateEdit.bindTableSave();
        templateEdit.delDiv();
        templateEdit.delRadioAndCheckBox();
        templateEdit.delTable();
        templateEdit.setup_draggable();

    };

    templateEdit.areaTemplate='<div class="row"> <div class="col-sm-12"> <div class="ibox float-e-margins"> <div class="ibox-title"> <h5><span>一般信息</span></h5> <div class="ibox-tools">' +
            ' <a class="collapse-link"> <i class="fa fa-chevron-up"></i> </a>' +
            '<a class="close-link"> <i class="fa fa-times"></i> </a> </div> </div> <div class="ibox-content"> ' +
            '<form class="form-horizontal m-t droppable sortable">' +
            '<div class="form-group"> <span> 填表说明：如:所有题目均共用答案，请在A、B、C、D下划“√”，每题限选一个答案。选项：A没有或很少B小部分时间  C相当多时间D绝大部分或全部时间。</span> </div>' +
            ' </form> </div> </div> </div> </div>';

    templateEdit.newArea=function(){
        $(".col-sm-8").append(templateEdit.areaTemplate);
        templateEdit.setup_draggable();
    };

    templateEdit.bindTitle=function(){
        $(".col-sm-8").on("click","span", function(event) {
            var title=$(this).text();
            var size=title.length+10;
            if(title.length>30){
                $(this).replaceWith('<textarea style="width: '+size*5+'px"  name="edit" type="text">'+title+'</textarea>');
            }
            else {
                $(this).replaceWith('<input size="'+size+'" name="edit" type="text" value="'+title+'"/>');
            }

            //do something here
            event.stopPropagation();
        });

    };

    templateEdit.bindTitleSave=function(){
        $(".col-sm-8").on("blur","[name='edit']", function() {
            var title=$(this).val();
            $(this).replaceWith('<span>'+title+'</span>');
        });
    };



    templateEdit.delRadioAndCheckBox=function(){
        $(".col-sm-8").on("dblclick",".checkbox-inline", function(event) {
            $(this).remove();
            event.stopPropagation();
        });

        $(".col-sm-8").on("dblclick",".radio-inline", function(event) {
            $(this).remove();
            event.stopPropagation();
        });

    };

    templateEdit.delTable=function(){
        $(".col-sm-8").on("dblclick","th", function(event) {
            $(this).remove();
            event.stopPropagation();
        });

        $(".col-sm-8").on("dblclick","td", function(event) {
            $(this).remove();
            event.stopPropagation();
        });

    };

    templateEdit.delDiv=function(){
        $(".col-sm-8").on("dblclick",".form-group", function() {
            $(this).remove();

            //do something here
        });
    };


    templateEdit.bindTable=function(){
        $(".col-sm-8").on("click","td", function(event) {
            var title=$(this).text();
            var size=title.length+10;
            $(this).replaceWith('<input size="'+size+'" name="editTable" type="text" value="'+title+'"/>');

            //do something here
            event.stopPropagation();
        });

        $(".col-sm-8").on("click","th", function(event) {
            var title=$(this).text();
            var size=title.length+10;
            $(this).replaceWith('<input size="'+size+'" name="editTable" type="text" value="'+title+'"/>');

            //do something here
            event.stopPropagation();
        });
    };



    templateEdit.bindTableSave=function(){
        $(".col-sm-8").on("blur","[name='editTable']", function() {
            var title=$(this).val();
            $(this).replaceWith('<td>'+title+'</td>');
        });

//        $(document).on("click",".col-sm-8", function() {
//            $("[name='editTable']")
//            var title=$(this).val();
//            $(this).replaceWith('<td>'+title+'</td>');
//        });
    };


    templateEdit.setTableColRow=function(){
        var type=layer.open({
            type: 1,
            title: '设置表格',
            area: ['20%', '20%'],
            btn:['确定选择'],
            content:"",
            yes: function(index, layero){
                //获取行列数量
                layer.close(index);
            },
            end:function(){
            }
        });
    };

    templateEdit.setRadioAndCheckBox=function(){};


    templateEdit.setup_draggable = function() {
        $(".sortable",".col-sm-8").sortable({
//            revert:true
        });

        $(".draggable",".col-sm-4").draggable({
//            appendTo: "body",
            connectToSortable: ".sortable",
            helper: "clone"
//            revert: "invalid"
        });
        $(".droppable").droppable({
            drop:function(event,ui){
//                var isMove=console.log($(ui.draggable).hasClass("ui-sortable-helper"));//true在移动，false添加
//
//                if(!isMove){
//                    var orig=$(ui.draggable);
//                    if($("table",orig).length>0){
//                        var tr='';
//                        $("table tbody",orig).append(tr);
//                        layer.msg("请输入行列数");
//                    }
//                }


                $(".sortable",this).sortable();
            }

        });

    };



    templateEdit.save=function(){
        if($("[name='edit']").length>0){
            layer.msg("请保存修改内容！");
            return;
        }

        var contentHtml=$(".col-sm-8").html();
        var templateId=/*[[${template.id}]]*/ '';
        var customerId=/*[[${template.customerId}]]*/ '';
        var name=$("input[name='templateName']").val();

        $.ajax({
            type: "POST",
            dataType: 'json',
            url: "saveTemplate",
            contentType:"application/json",
            data: JSON.stringify({id:templateId,name:name,customerId:customerId,content:contentHtml}),
            success: function (result) {
                layer.msg("保存成功", {icon: 1});
            }

        });





    };


    /*]]>*/
</script>
</body>

</html>