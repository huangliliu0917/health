<!DOCTYPE html>
<!--
  ~ 版权所有:杭州火图科技有限公司
  ~ 地址:浙江省杭州市滨江区西兴街道阡陌路智慧E谷B幢4楼
  ~
  ~ (c) Copyright Hangzhou Hot Technology Co., Ltd.
  ~ Floor 4,Block B,Wisdom E Valley,Qianmo Road,Binjiang District
  ~ 2013-2016. All rights reserved.
  -->

<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>


    <title>表单详情</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>

    <link rel="shortcut icon" href="favicon.ico"/>
    <link href="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/plugins/iCheck/custom.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/animate.min.css" rel="stylesheet"/>
    <link href="../css/style.min.css?v=4.0.0" rel="stylesheet"/><base target="_blank"/>

    <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>

</head>

<body onload="templateEdit.load()" class="gray-bg">
<div class="wrapper wrapper-content">
    <div style="position: fixed;width: 100%;height: 100%;overflow-y: scroll;">
    <div class="col-sm-4">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>元素</h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>

                </div>
            </div>
            <div class="ibox-content">

                <div class="alert alert-info">
                    拖拽左侧的表单元素到右侧区域，即可生成相应的HTML代码，表单代码，轻松搞定！
                </div>
                <form role="form" class="form-horizontal m-t">

                    <div class="form-group">
                        <label class="col-sm-3 control-label">模板名称：</label>
                        <div class="col-sm-9">
                            <input th:value="${template.name}" type="text" name="templateName" class="form-control" placeholder="请输入文本"/>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>
                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>文本框：</span></label>
                        <div class="col-sm-10">
                            <input type="text" name="" class="form-control"/>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>


                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>富文本：</span></label>
                        <div class="col-sm-10">
                            <div class="summernote">
                            </div>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>


                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>表格：</span></label>
                        <div class="col-sm-10">
                            <table class="table table-bordered">
                            <thead>
                            <tr>
                            <th>#</th>
                            <th>姓名</th>
                            <th>性别</th>
                            <th>年龄</th>
                            <th>年龄</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                            <td><span>1</span></td>
                            <td>张三</td>
                            <td>男</td>
                            <td>23</td>
                            <td>23</td>
                            </tr>
                            <tr>
                            <td>2</td>
                            <td>李四</td>
                            <td>男</td>
                            <td>27</td>
                            <td>23</td>
                            </tr>

                            </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>
                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>纯文本：</span></label>
                        <div class="col-sm-10">
                            <p class="form-control-static"><span>这里是纯文字信息</span></p>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>

                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>单选框：</span></label>
                        <div class="col-sm-10 ">
                            <label class="radio-inline i-checks ">
                                <input type="radio" value="option1"/>&nbsp;
                                <span>选项1</span></label>
                            <label class="radio-inline i-checks ">
                                <input type="radio" value="option2"/>&nbsp;
                                <span>选项2</span></label>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>

                    <div class="form-group draggable">
                        <label class="col-sm-2 control-label"><span>复选框：</span></label>
                        <div class="col-sm-10 ">
                            <label class="checkbox-inline i-checks ">
                                <input type="checkbox" value="option1" id="inlineCheckbox1"/>&nbsp;<span>选项1</span></label>
                            <label class="checkbox-inline i-checks ">
                                <input type="checkbox" value="option2" id="inlineCheckbox2"/>&nbsp;<span>选项2</span></label>
                            <label class="checkbox-inline i-checks ">
                                <input type="checkbox" value="option3" id="inlineCheckbox3"/>&nbsp;<span>选项3</span></label>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>
                    <div class=" text-center">
                        <button class="btn btn-primary" type="button" onclick="templateEdit.newArea()">新建区域</button>
                        <button class="btn btn-primary" type="button" onclick="templateEdit.save(this)">保存模板</button>
                    </div>
                </form>
                <div class="clearfix"></div>
            </div>
        </div>


    </div>
    </div>


    <div class="col-sm-8" th:utext="${template.content}" style="float: right"></div>

    <div id="tableSet" class="form-group" style="display: none">
        <label class="col-sm-3 control-label">列数：</label>
        <div class="col-sm-9">
            <input  type="text" name="col" class="form-control" placeholder="请输入列数"/>
        </div>

        <label class="col-sm-3 control-label">行数：</label>
        <div class="col-sm-9">
            <input  type="text" name="row" class="form-control" placeholder="请输入行数"/>
        </div>
    </div>

    <div id="radioAndChk" class="form-group" style="display: none">
        <label class="col-sm-3 control-label">选项数量：</label>
        <div class="col-sm-9">
            <input  type="text" name="number" class="form-control" placeholder="请输入数量"/>
        </div>
    </div>

</div>

<script src="http://resali.huobanplus.com/cdn/jquery/2.2.4/jquery.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/bootstrap.min.js"></script>
<script src="../js/content.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/jquery-ui-1.10.4.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/beautifyhtml/beautifyhtml.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/iCheck/icheck.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/layer/2.4/layer.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>

<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/

    var templateEdit={};

    templateEdit.id=/*[[${template.id}]]*/ '';

    templateEdit.radioId=0;

    templateEdit.load=function(){
        templateEdit.delDiv();
        templateEdit.setup_draggable();
        templateEdit.xeditable();
        templateEdit.setICheck();

    };

    templateEdit.setICheck=function(){
        $(".i-checks").iCheck({
            checkboxClass: "icheckbox_square-green",
            radioClass: "iradio_square-green"
        })
    };

    templateEdit.setNotICheck=function(){
        $(".i-checks").iCheck("destroy")
    };

    templateEdit.xeditable=function(){
        $('span','.col-sm-8').editable({
            unsavedclass:"",
            emptyclass:"",
            defaultValue:"null",
            emptytext:"null"
        });
    };

    templateEdit.areaTemplate='<div class="row"> <div class="col-sm-12"> <div class="ibox float-e-margins"> <div class="ibox-title"> <h5><span>一般信息</span></h5> <div class="ibox-tools">' +
            ' <a class="collapse-link"> <i class="fa fa-chevron-up"></i> </a>' +
            '<a class="close-link"> <i class="fa fa-times"></i> </a> </div> </div> <div class="ibox-content"> ' +
            '<form class="form-horizontal m-t droppable sortable">' +
            '<div class="form-group"> <span> 填表说明：如:所有题目均共用答案，请在A、B、C、D下划“√”，每题限选一个答案。选项：A没有或很少B小部分时间  C相当多时间D绝大部分或全部时间。</span> </div>' +
            ' </form> </div> </div> </div> </div>';

    templateEdit.newArea=function(){
        $(".col-sm-8").append(templateEdit.areaTemplate);
        templateEdit.setup_draggable();
        templateEdit.xeditable();
    };

    templateEdit.delDiv=function(){
        $(".col-sm-8").on("dblclick",".form-group", function() {
            var $obj=$(this);
            layer.confirm('确定删除吗？', {
                btn: ['确定','取消'] //按钮
            }, function(index){
                $obj.remove();
                layer.close(index);
            });

            //do something here
        });
    };

    templateEdit.showTableColRow=function(table){
        var type=layer.open({
            type: 1,
            title: '设置表格',
            area: ['20%', '20%'],
            btn:['确定选择'],
            content:$("#tableSet"),
            yes: function(index, layero){
                //获取行列数量
                var col=$("input[name='col']").val();
                var row=$("input[name='row']").val();
                templateEdit.setColRow(table,col,row);
                templateEdit.xeditable();
                layer.close(index);
            },
            end:function(){
            }
        });
    };

    templateEdit.showRadio=function(obj){
        var type=layer.open({
            type: 1,
            title: '设置单选按钮',
            area: ['20%', '20%'],
            btn:['确定选择'],
            content:$("#radioAndChk"),
            yes: function(index, layero){
                //获取数量
                var number=$("input[name='number']","#radioAndChk").val();
                templateEdit.bulidRadio(obj,number);
                templateEdit.xeditable();
                layer.close(index);
            },
            end:function(){
            }
        });
    };

    templateEdit.showCheckBox=function(obj){
        var type=layer.open({
            type: 1,
            title: '设置复选框',
            area: ['20%', '20%'],
            btn:['确定选择'],
            content:$("#radioAndChk"),
            yes: function(index, layero){
                //获取数量
                var number=$("input[name='number']","#radioAndChk").val();
                templateEdit.bulidChk(obj,number);
                templateEdit.xeditable();
                layer.close(index);
            },
            end:function(){
            }
        });
    };

    templateEdit.setColRow=function(table,col,row){
        var thead='<tr>';
        for(var i=0;i<col;i++){
            thead=thead+'<th><span></span></th>';
        }
        thead=thead+'</tr>';
        $("thead",table).append(thead);

        var tbody='<tr>';
        for(var i=0;i<col;i++){
            tbody=tbody+'<td><span></span></td>';
        }
        tbody=tbody+'</tr>';

        for(var i=0;i<row-1;i++){
            $("tbody",table).append(tbody);
        }
    };

    templateEdit.bulidRadio=function(obj,number){
        for(var i=0;i<number;i++){
            var html='<label class="radio-inline i-checks"> ' +
                    '<input disabled="disabled" name="ra'+templateEdit.radioId+'" type="radio"/>&nbsp;<span></span></label>';
            $(obj).append(html);
        }
        templateEdit.setICheck();

    };

    templateEdit.bulidChk=function(obj,number){
        for(var i=0;i<number;i++){
            var html='<label class="checkbox-inline i-checks"> ' +
                    '<input disabled="disabled" type="checkbox"/>&nbsp;<span></span></label>';
            $(obj).append(html);
        }
        templateEdit.setICheck();
    };

    templateEdit.setup_draggable = function() {
        $(".sortable",".col-sm-8").sortable({
//            revert:true
            stop: function(event,ui) {
                var orig=$(ui.item);
                if($("table",orig).length>0){
                    var isMove=$(ui.item).hasClass("hasTable");//true在移动，false添加

                    if(!isMove){//添加
                        $(ui.item).addClass("hasTable");
                        var table=$("table",orig);
                        $("thead",table).empty();
                        $("tbody",table).empty();

                        templateEdit.showTableColRow(table);
                    }
                }

                if($("input[type='radio']",orig).length>0){
                    var isMove=$(ui.item).hasClass("hasRadio");//true在移动，false添加
                    if(!isMove){//添加
                        $(ui.item).addClass("hasRadio");
                        var radios=$(".col-sm-10 ",orig);
                        $(radios).empty();

                        templateEdit.showRadio(radios);
                        templateEdit.radioId++;
                    }
                }

                if($("input[type='checkbox']",orig).length>0){
                    var isMove=$(ui.item).hasClass("hasChk");//true在移动，false添加
                    if(!isMove){//添加
                        $(ui.item).addClass("hasChk");
                        var chk=$(".col-sm-10 ",orig);
                        $(chk).empty();
                        templateEdit.showCheckBox(chk);
                    }
                }

                $(".sortable",this).sortable();
                templateEdit.xeditable();


            }
        });

        $(".draggable",".col-sm-4").draggable({
            appendTo: "body",
            connectToSortable: ".sortable",
            helper: "clone"
        });
        $(".droppable").droppable({
            accept: ".draggable"
        });

    };

    templateEdit.save=function(obj){
        if($(obj).attr("class")=="btn btn-primary disabled"){
            return;
        }
        $(obj).attr("class","btn btn-primary disabled");
        var ld=layer.load(5, {shade: false});
        $("span",".col-sm-8").removeClass();

        templateEdit.setNotICheck();
        $("input",".col-sm-8").attr("disabled",false);
        var contentHtml=$(".col-sm-8").html();
        templateEdit.setICheck();
        $("input",".col-sm-8").attr("disabled",true);
        var templateId=templateEdit.id;
        var customerId=/*[[${template.customerId}]]*/ '';
        var name=$("input[name='templateName']").val();

        $.ajax({
            type: "POST",
            dataType: 'json',
            url: "saveTemplate",
            contentType:"application/json",
            data: JSON.stringify({id:templateId,name:name,customerId:customerId,content:contentHtml}),
            success: function (result) {
                layer.close(ld);
                layer.msg("保存成功", {icon: 1});
                templateEdit.id=result.id;
                $(obj).attr("class","btn btn-primary");
            },
            error:function(e){
                layer.close(ld);
                layer.msg("保存失败！");
                $(obj).attr("class","btn btn-primary");
            }

        });
    };



    /*]]>*/
</script>
</body>

</html>